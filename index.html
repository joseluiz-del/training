<!DOCTYPE html>
<!-- saved from url=(0065)file:///C:/Users/HxTos/Downloads/partyard1-viewer-homolog-pt.html -->
<html lang="pt-BR"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Yard Training Viewer ‚Äî Homologa√ß√£o (tema claro azulado)</title>
  <style>
    :root{
      /* Levemente azulado */
      --bg:#eef3ff;
      --panel:#ffffff;
      --panel2:#f3f7ff;
      --text:#0a1430;
      --muted:#4f6187;
      --line:rgba(10,20,48,.12);
      --accent:#1b6cff;
      --accent2:#6b3dff;
      --good:#14b8a6;
      --warn:#f59e0b;
      --bad:#ef4444;
      --shadow: 0 14px 34px rgba(10,20,48,.12);
      --radius:16px;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: var(--sans);
      background:
        radial-gradient(1200px 650px at 12% 0%, rgba(27,108,255,.14), transparent 55%),
        radial-gradient(900px 600px at 88% 10%, rgba(107,61,255,.10), transparent 55%),
        radial-gradient(900px 700px at 45% 110%, rgba(14,165,233,.08), transparent 55%),
        var(--bg);
      color:var(--text);
    }
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}

    .app{
      display:grid;
      grid-template-columns: 380px 1fr;
      min-height:100vh;
    }
    @media (max-width: 1060px){
      .app{grid-template-columns: 1fr}
      .sidebar{position:sticky; top:0; z-index: 10}
      .frameWrap{height: calc(100vh - 260px)}
    }
    .sidebar{
      padding:18px;
      background: linear-gradient(180deg, rgba(255,255,255,.90), rgba(255,255,255,.70));
      border-right:1px solid var(--line);
      backdrop-filter: blur(10px);
    }

    .card{
      border:1px solid var(--line);
      border-radius: calc(var(--radius) + 2px);
      background: rgba(255,255,255,.92);
      box-shadow: var(--shadow);
      padding:14px 14px;
      margin-bottom:14px;
    }

    .brandTop{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
    }
    .dot{
      width:12px; height:12px; border-radius:999px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 0 0 4px rgba(27,108,255,.10);
      flex:0 0 12px;
    }
    .brand h1{
      margin:0;
      font-size:15px;
      letter-spacing:.2px;
      line-height:1.2;
    }
    .brand p{
      margin:8px 0 0 0;
      color:var(--muted);
      font-size:12.5px;
      line-height:1.4;
    }

    .row{
      display:flex; gap:10px; align-items:center;
      margin-top:12px;
    }
    .btn{
      appearance:none;
      border:1px solid var(--line);
      background: rgba(10,20,48,.03);
      color:var(--text);
      border-radius: 12px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:800;
      font-size:12.5px;
      box-shadow: var(--shadow);
      user-select:none;
      display:inline-flex;
      gap:8px;
      align-items:center;
      justify-content:center;
      width:100%;
      transition: transform .08s ease, background .15s ease;
    }
    .btn:hover{background: rgba(10,20,48,.05)}
    .btn:active{transform: translateY(1px)}
    .btn.primary{
      background: linear-gradient(90deg, rgba(27,108,255,.14), rgba(107,61,255,.10));
    }

    .select{
      width:100%;
      border:1px solid var(--line);
      background: rgba(10,20,48,.03);
      color:var(--text);
      border-radius: 12px;
      padding:10px 12px;
      font-weight:800;
      box-shadow: var(--shadow);
      outline:none;
    }

    .search{
      margin-top: 12px;
      display:flex;
      gap:10px;
      align-items:center;
      border:1px solid var(--line);
      background: rgba(255,255,255,.94);
      border-radius: 12px;
      padding:10px 12px;
      box-shadow: var(--shadow);
    }
    .search input{
      width:100%;
      border:0;
      outline:0;
      background:transparent;
      color:var(--text);
      font-size:13px;
    }
    .hint{
      margin-top: 10px;
      color: var(--muted);
      font-size:12px;
      line-height:1.45;
    }

    .sectionTitle{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      margin: 0 0 8px 0;
    }
    .sectionTitle h3{
      margin:0;
      font-size:13px;
      letter-spacing:.2px;
    }
    .pill{
      border:1px solid var(--line);
      padding:6px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.90);
      box-shadow: var(--shadow);
      font-size:12px;
      color: var(--muted);
      white-space:nowrap;
    }

    /* Quick menu chips */
    .chips{display:flex; flex-wrap:wrap; gap:8px}
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border:1px solid var(--line);
      border-radius: 14px;
      background: rgba(10,20,48,.02);
      font-size: 12px;
      color: var(--muted);
      cursor:pointer;
      user-select:none;
      box-shadow: var(--shadow);
    }
    .chip:hover{background: rgba(10,20,48,.04)}
    .chip .ic{
      width:18px; height:18px;
      border-radius: 9px;
      background: linear-gradient(135deg, rgba(27,108,255,.18), rgba(107,61,255,.12));
      border:1px solid rgba(10,20,48,.10);
      display:flex; align-items:center; justify-content:center;
      color: var(--text);
      font-size: 12px;
      line-height:1;
    }
    .chip code{font-family: var(--mono); font-size: 12px; color: var(--text)}

    /* TOC */
    .nav{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(255,255,255,.92);
      overflow:hidden;
      box-shadow: var(--shadow);
    }
    .navHead{
      padding:14px 14px 10px 14px;
      border-bottom: 1px solid var(--line);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }
    .navHead h3{margin:0; font-size:13px; letter-spacing:.2px}
    .navHead small{color:var(--muted)}
    .navList{max-height: calc(100vh - 520px); overflow:auto}
    .navItem{
      display:flex;
      gap:12px;
      align-items:flex-start;
      padding:10px 14px;
      border-bottom: 1px solid var(--line);
      cursor:pointer;
      user-select:none;
      transition: background .15s ease;
    }
    .navItem:last-child{border-bottom:none}
    .navItem:hover{background: rgba(10,20,48,.03)}
    .navItem.active{
      background: linear-gradient(90deg, rgba(27,108,255,.12), rgba(107,61,255,.08));
    }
    .n{
      font-family: var(--mono);
      font-size:12px;
      color: var(--muted);
      padding-top:2px;
      width: 34px;
      flex: 0 0 34px;
    }
    .navText b{display:block; font-size:13px; margin-bottom:3px}
    .navText span{display:block; font-size:12px; color:var(--muted); line-height:1.35}

    /* Main */
    .main{display:flex; flex-direction:column; min-width:0}
    .topbar{
      position:sticky; top:0; z-index: 9;
      backdrop-filter: blur(10px);
      background: rgba(238,243,255,.78);
      border-bottom: 1px solid var(--line);
    }
    .topbarInner{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding: 12px 16px;
    }
    .crumbs{
      display:flex; align-items:center; gap:8px; flex-wrap:wrap;
      font-size: 12.5px;
      color: var(--muted);
    }
    .crumbs b{color: var(--text)}
    .crumb{
      display:inline-flex; align-items:center; gap:8px;
      padding: 6px 10px;
      border:1px solid var(--line);
      border-radius: 999px;
      background: rgba(255,255,255,.90);
      box-shadow: var(--shadow);
      font-size: 12px;
      color: var(--muted);
    }
    .crumb .ic{
      width:16px; height:16px;
      border-radius: 8px;
      background: linear-gradient(135deg, rgba(27,108,255,.18), rgba(107,61,255,.12));
      border:1px solid rgba(10,20,48,.10);
      display:flex; align-items:center; justify-content:center;
      font-size:11px;
      color: var(--text);
    }

    .frameWrap{
      flex:1;
      min-height: 0;
      padding: 0;
      background: rgba(255,255,255,.55);
    }
    iframe{
      width:100%;
      height:100%;
      border:0;
      display:block;
      background:white;
    }

    /* Presentation overlay controls */
    .presentBar{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 18px;
      z-index: 999;
      display:none;
      gap:10px;
      align-items:center;
      padding: 10px 12px;
      border:1px solid var(--line);
      border-radius: 999px;
      background: rgba(255,255,255,.92);
      box-shadow: var(--shadow);
    }
    .presentBar.show{display:flex}
    .presentBar .miniBtn{
      border:1px solid var(--line);
      background: rgba(10,20,48,.03);
      border-radius: 999px;
      padding: 8px 10px;
      cursor:pointer;
      font-weight:900;
      font-size:12.5px;
      user-select:none;
    }
    .presentBar .miniBtn:hover{background: rgba(10,20,48,.05)}
    .presentBar .meter{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      padding: 0 6px;
      white-space:nowrap;
    }
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="card brand">
        <div class="brandTop">
          <div style="display:flex; gap:10px; align-items:center">
            <span class="dot"></span>
            <h1 id="uiTitle">Porttech 2911 ‚Ä¢ Navis N4 ‚Ä¢ Yard</h1>
          </div>
          <span class="pill" id="uiTheme">Homologa√ß√£o ‚Ä¢ Claro</span>
        </div>
        <p id="uiDesc">‚ÄúUAT-ready‚Äù mode: step cards, callouts, TOC, project-style breadcrumbs, and presentation mode (one section at a time).</p>

        <div class="row">
          <button class="btn primary" id="btnEnhance">‚ú® Enhance + TOC</button>
          <button class="btn" id="btnPresent">üé¨ Presentation</button>
        </div>

        <div class="row">
          <button class="btn" id="btnPrint">üñ®Ô∏è Print/PDF</button>
          <button class="btn" id="btnReset">‚Ü©Ô∏é Reset</button>
        </div>

        <div class="row">
          <select class="select" id="lang">
            <option value="pt">UI em Portugu√™s</option>
            <option value="en">UI in English</option>
            <option value="both">PT + EN (UI)</option>
          </select>
        </div>

        <div class="row">
          <select class="select" id="contentLang">
            <option value="pt" selected="">Conte√∫do em Portugu√™s</option>
            <option value="en">Content in English</option>
          </select>
        </div>

        <div class="search">
          <input id="q" placeholder="Buscar no conte√∫do (dentro do iframe)...">
        </div>
        <div class="hint" id="uiHint">Tip: use Presentation for classroom training; use the TOC for quick navigation.</div>
      </div>

      <div class="card">
        <div class="sectionTitle">
          <h3 id="uiQuick">N4 shortcuts (menu)</h3>
          <span class="pill">clique para ‚Äúprocurar‚Äù</span>
        </div>
        <div class="chips" id="quickChips"></div>
        <div class="hint" id="uiQuickHint">Shortcuts won‚Äôt open N4 (offline), but jump to the part where the menu path is mentioned to standardize training.</div>
      </div>

      <div class="nav" aria-label="Sum√°rio">
        <div class="navHead">
          <div>
            <h3 id="uiToc">Table of contents</h3>
            <small id="uiTocSub">Auto-generated</small>
          </div>
          <small class="pill" id="uiTocCount">0 itens</small>
        </div>
        <div class="navList" id="toc"></div>
      </div>
    </aside>

    <main class="main">
      <div class="topbar">
        <div class="topbarInner">
          <div class="crumbs" id="crumbs">
            <span class="crumb"><span class="ic">üè∑Ô∏è</span><span id="c1">Porttech 2911</span></span>
            <span class="crumb"><span class="ic">üß≠</span><span id="c2">Navis N4</span></span>
            <span class="crumb"><span class="ic">üìö</span><span id="c3">M√≥dulo 1 ‚Äî Yard Basics</span></span>
            <span class="crumb"><span class="ic">üìç</span><b id="c4">‚Äî</b></span>
          </div>
          <div class="pill" id="uiPill">Mode: Ops / Training</div>
        </div>
      </div>

      <div class="frameWrap">
        <iframe id="frame" src="./Yard Training Viewer ‚Äî Homologa√ß√£o (tema claro azulado)_files/partyard1-converted-pt.html" title="Conte√∫do"></iframe>
      </div>
    </main>
  </div>

  <div class="presentBar" id="presentBar" aria-hidden="true">
    <div class="miniBtn" id="prev">‚üµ</div>
    <div class="meter" id="meter">0 / 0</div>
    <div class="miniBtn" id="next">‚ü∂</div>
    <div class="miniBtn" id="exit">‚úï</div>
  </div>

  <script>
    const ui = {
      pt: {
        title: "Porttech 2911 ‚Ä¢ Navis N4 ‚Ä¢ Yard",
        desc: "Modo ‚Äúhomologa√ß√£o‚Äù: cards por passo, callouts, sum√°rio, breadcrumbs no padr√£o do projeto e modo apresenta√ß√£o (1 se√ß√£o por vez).",
        hint: "Dica: use Apresenta√ß√£o para treinar em sala; use o Sum√°rio para navegar por t√≥picos rapidamente.",
        quick: "Atalhos N4 (menu)",
        quickHint: "Esses atalhos n√£o ‚Äúabrem‚Äù o N4 (offline), mas te levam ao trecho onde o caminho de menu √© citado, para padronizar o treinamento.",
        toc: "Sum√°rio",
        tocSub: "Gerado automaticamente",
        pill: "Modo: Opera√ß√£o / Treinamento",
        enhance: "‚ú® Melhorias + TOC",
        present: "üé¨ Apresenta√ß√£o",
        print: "üñ®Ô∏è Imprimir/PDF",
        reset: "‚Ü©Ô∏é Reset"
      },
      en: {
        title: "Porttech 2911 ‚Ä¢ Navis N4 ‚Ä¢ Yard",
        desc: "‚ÄúUAT-ready‚Äù mode: step cards, callouts, TOC, project-style breadcrumbs, and presentation mode (one section at a time).",
        hint: "Tip: use Presentation for classroom training; use the TOC for quick navigation.",
        quick: "N4 shortcuts (menu)",
        quickHint: "Shortcuts won‚Äôt open N4 (offline), but jump to the part where the menu path is mentioned to standardize training.",
        toc: "Table of contents",
        tocSub: "Auto-generated",
        pill: "Mode: Ops / Training",
        enhance: "‚ú® Enhance + TOC",
        present: "üé¨ Presentation",
        print: "üñ®Ô∏è Print/PDF",
        reset: "‚Ü©Ô∏é Reset"
      }
    };

    const els = {
      lang: document.getElementById('lang'),

      contentLang: document.getElementById('contentLang'),

      uiTitle: document.getElementById('uiTitle'),
      uiDesc: document.getElementById('uiDesc'),
      uiHint: document.getElementById('uiHint'),
      uiQuick: document.getElementById('uiQuick'),
      uiQuickHint: document.getElementById('uiQuickHint'),
      uiToc: document.getElementById('uiToc'),
      uiTocSub: document.getElementById('uiTocSub'),
      uiPill: document.getElementById('uiPill'),
      uiTocCount: document.getElementById('uiTocCount'),
      btnEnhance: document.getElementById('btnEnhance'),
      btnPresent: document.getElementById('btnPresent'),
      btnPrint: document.getElementById('btnPrint'),
      btnReset: document.getElementById('btnReset'),
      q: document.getElementById('q'),
      toc: document.getElementById('toc'),
      quickChips: document.getElementById('quickChips'),
      frame: document.getElementById('frame'),
      c4: document.getElementById('c4'),
      presentBar: document.getElementById('presentBar'),
      prev: document.getElementById('prev'),
      next: document.getElementById('next'),
      exit: document.getElementById('exit'),
      meter: document.getElementById('meter')
    };

    function setUI(mode){
      const t = ui[mode] || ui.pt;
      els.uiTitle.textContent = t.title;
      els.uiDesc.textContent = t.desc;
      els.uiHint.textContent = t.hint;
      els.uiQuick.textContent = t.quick;
      els.uiQuickHint.textContent = t.quickHint;
      els.uiToc.textContent = t.toc;
      els.uiTocSub.textContent = t.tocSub;
      els.uiPill.textContent = t.pill;
      els.btnEnhance.textContent = t.enhance;
      els.btnPresent.textContent = t.present;
      els.btnPrint.textContent = t.print;
      els.btnReset.textContent = t.reset;
    }
    function setUIBoth(){
      els.uiTitle.textContent = ui.pt.title;
      els.uiDesc.textContent = ui.pt.desc + " / " + ui.en.desc;
      els.uiHint.textContent = ui.pt.hint + " / " + ui.en.hint;
      els.uiQuick.textContent = ui.pt.quick + " / " + ui.en.quick;
      els.uiQuickHint.textContent = ui.pt.quickHint + " / " + ui.en.quickHint;
      els.uiToc.textContent = ui.pt.toc + " / " + ui.en.toc;
      els.uiTocSub.textContent = ui.pt.tocSub + " / " + ui.en.tocSub;
      els.uiPill.textContent = ui.pt.pill + " / " + ui.en.pill;
      els.btnEnhance.textContent = ui.pt.enhance + " / " + ui.en.enhance;
      els.btnPresent.textContent = ui.pt.present + " / " + ui.en.present;
      els.btnPrint.textContent = ui.pt.print + " / " + ui.en.print;
      els.btnReset.textContent = ui.pt.reset + " / " + ui.en.reset;
    }
    function applyUILang(){
      const v = els.lang.value;
      if(v === "both") setUIBoth();
      else setUI(v);
    }
    els.lang.addEventListener('change', applyUILang);
    applyUILang();


    // Content language (iframe source)
    const contentFiles = {
      pt: "partyard1-converted-pt.html",
      en: "partyard1-converted.html"
    };
    els.contentLang.addEventListener('change', ()=>{
      const v = els.contentLang.value;
      togglePresentation(false);
      els.frame.src = contentFiles[v] || contentFiles.pt;
      // Clear TOC/search until the iframe reloads and re-enhances
      els.toc.innerHTML = "";
      els.quickChips.innerHTML = "";
      els.uiTocCount.textContent = "0 itens";
      els.c4.textContent = "‚Äî";
      els.q.value = "";
    });


    // ---------- Enhancer injected into iframe ----------
    const verbs = [
      ["Choose", "Selecione"],["Select", "Selecione"],["Set", "Defina"],["Open", "Abra"],
      ["Click", "Clique"],["Double-click", "D√™ duplo clique"],["Verify", "Verifique"],
      ["Confirm", "Confirme"],["Use", "Use"],["Create", "Crie"],["Modify", "Modifique"],
      ["Change", "Altere"],["Keep", "Mantenha"],["Refer to", "Consulte"]
    ];
    function guessActionPT(line){
      for(const [en, pt] of verbs){
        if(line.startsWith(en + " ") || line.startsWith(en + "\u00A0")) return pt;
      }
      return "A√ß√£o";
    }

    // Presentation state
    const present = { on:false, slides:[], idx:0 };

    function enhanceIframe(){
      const fdoc = els.frame.contentDocument;
      if(!fdoc) return;

      // Prevent double-inject (idempotent-ish)
      if(fdoc.documentElement.getAttribute('data-ptc-enhanced') === '1') return;

      // Convert common PDF classes to headings
      function toHeading(p, level){
        const h = fdoc.createElement("h"+level);
        h.textContent = (p.textContent || "").trim().replace(/\s+/g,' ');
        p.replaceWith(h);
        return h;
      }
      fdoc.querySelectorAll('p.s2').forEach(p=>toHeading(p,1));
      fdoc.querySelectorAll('p.s6, p.s7').forEach(p=>toHeading(p,2));

      // Cardify step-like paragraphs
      const stepRx = /^(Choose|Select|Set|Open|Click|Double-click|Verify|Confirm|Use|Create|Modify|Change|Keep|Refer to)\b/;
      fdoc.querySelectorAll('p').forEach(p=>{
        const t = (p.textContent||"").trim().replace(/\s+/g,' ');
        if(!t || t.length < 6) return;
        if(!stepRx.test(t)) return;

        const card = fdoc.createElement('div');
        card.className = 'ptc-card';

        const head = fdoc.createElement('div');
        head.className = 'ptc-card-head';

        const badge = fdoc.createElement('div');
        badge.className = 'ptc-badge';
        badge.innerHTML = `<span class="ptc-dot"></span><b>${guessActionPT(t)}</b><span class="ptc-muted">/ Action</span>`;

        head.appendChild(badge);

        const body = fdoc.createElement('div');
        body.className = 'ptc-card-body';

        // Keep original paragraph node (not clone) to preserve existing links/format
        body.appendChild(p);

        card.appendChild(head);
        card.appendChild(body);
        p.replaceWith(card); // no-op since p moved; still ok
      });

      // Callouts: Note/Tip/Warning:
      const calloutRx = /^(Note|Tip|Warning)\s*:/i;
      fdoc.querySelectorAll('p').forEach(p=>{
        const t = (p.textContent||"").trim().replace(/\s+/g,' ');
        const m = t.match(calloutRx);
        if(!m) return;
        const kind = m[1].toLowerCase();
        const box = fdoc.createElement('div');
        box.className = 'ptc-callout ' + kind;
        const title = fdoc.createElement('div');
        title.className = 'ptc-callout-title';
        title.textContent = (kind==="note"?"Nota":"") + (kind==="tip"?"Dica":"") + (kind==="warning"?"Aten√ß√£o":"") + " / " + m[1];
        const body = fdoc.createElement('div');
        body.className = 'ptc-callout-body';
        body.textContent = t.replace(calloutRx,"").trim();
        box.appendChild(title);
        box.appendChild(body);
        p.replaceWith(box);
      });

      // Inject light-theme styling inside iframe + presentation styles
      const style = fdoc.createElement('style');
      style.textContent = `
        html,body{background:#fff !important}
        body{font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial !important; color:#0a1430 !important; line-height:1.6}
        body > div, body > table, body > main {max-width: 980px; margin: 0 auto}
        img{max-width: 100%; border-radius: 14px; border:1px solid rgba(10,20,48,.12); box-shadow: 0 14px 34px rgba(10,20,48,.12)}
        h1,h2,h3,h4{margin: 18px 0 10px !important}
        h1{font-size: 26px !important}
        h2{font-size: 20px !important}
        h3{font-size: 16px !important}
        p{font-size: 15px !important; color:#0a1430 !important}
        a{color:#1b6cff}
        mark{background: rgba(27,108,255,.16); border-radius:6px; padding: 0 .15em}

        .ptc-card{
          border:1px solid rgba(10,20,48,.12);
          border-radius: 16px;
          background: rgba(10,20,48,.02);
          box-shadow: 0 14px 34px rgba(10,20,48,.10);
          margin: 12px 0;
          overflow:hidden;
        }
        .ptc-card-head{
          padding: 10px 12px;
          border-bottom: 1px solid rgba(10,20,48,.10);
          background: linear-gradient(90deg, rgba(27,108,255,.10), rgba(107,61,255,.06));
        }
        .ptc-badge{display:flex; align-items:center; gap:8px; font-size: 12.5px}
        .ptc-dot{
          width:10px; height:10px; border-radius:999px;
          background: linear-gradient(135deg, #1b6cff, #6b3dff);
          box-shadow: 0 0 0 4px rgba(27,108,255,.10);
        }
        .ptc-muted{color: rgba(10,20,48,.55)}
        .ptc-card-body{padding: 12px}
        .ptc-card-body p{margin: 0 !important}

        .ptc-callout{
          border:1px solid rgba(10,20,48,.12);
          border-radius: 16px;
          padding: 12px 14px;
          margin: 12px 0;
          box-shadow: 0 14px 34px rgba(10,20,48,.10);
          background: rgba(20,184,166,.06);
        }
        .ptc-callout.note{background: rgba(27,108,255,.06)}
        .ptc-callout.tip{background: rgba(20,184,166,.06)}
        .ptc-callout.warning{background: rgba(245,158,11,.10)}
        .ptc-callout-title{font-weight: 900; margin-bottom: 6px}
        .ptc-callout-body{color: rgba(10,20,48,.78)}

        /* Presentation mode (one section visible) */
        .ptc-slide{display:block}
        body.ptc-present .ptc-slide{display:none}
        body.ptc-present .ptc-slide.ptc-active{display:block}
        body.ptc-present{padding-bottom: 80px}
      `;
      fdoc.head.appendChild(style);

      // Assign IDs and build TOC from headings
      const headings = Array.from(fdoc.querySelectorAll('h1,h2,h3'))
        .filter(h => (h.textContent||"").trim().length > 0);

      const slug = (s)=> s.toLowerCase()
        .replace(/['"]/g,'')
        .replace(/[^a-z0-9]+/g,'-')
        .replace(/(^-|-$)/g,'')
        .slice(0,80) || ('sec-' + Math.random().toString(16).slice(2));

      const used = new Set();
      headings.forEach(h=>{
        if(!h.id){
          let id = slug(h.textContent.trim());
          while(used.has(id)) id = id + '-' + Math.random().toString(16).slice(2,6);
          used.add(id);
          h.id = id;
        }
      });

      // Wrap content into slides by H1/H2 (for presentation mode)
      buildSlides(fdoc);

      // Build TOC UI
      renderTOC(fdoc);

      // Build Quick chips from menu-path regex
      renderQuickChips(fdoc);

      // Breadcrumb current section on scroll (non-presentation)
      attachHeadingObserver(fdoc);

      // Search highlight inside iframe
      attachSearch(fdoc);

      fdoc.documentElement.setAttribute('data-ptc-enhanced','1');
    }

    function buildSlides(fdoc){
      // Reset slide wrapping if previously applied
      fdoc.querySelectorAll('.ptc-slide').forEach(x=>x.classList.remove('ptc-slide','ptc-active'));

      const nodes = Array.from(fdoc.body.childNodes).filter(n=>!(n.nodeType===3 && !n.textContent.trim()));
      const isHeading = (n)=> n.nodeType===1 && (n.tagName==='H1' || n.tagName==='H2');
      let current = null;

      const slides = [];
      const wrap = (startNode)=>{
        const s = fdoc.createElement('div');
        s.className = 'ptc-slide';
        startNode.parentNode.insertBefore(s, startNode);
        return s;
      };

      nodes.forEach(node=>{
        if(isHeading(node) || !current){
          current = wrap(node);
          slides.push(current);
        }
        current.appendChild(node);
      });

      present.slides = slides;
      present.idx = 0;
      if(slides[0]) slides[0].classList.add('ptc-active');
      updateMeter();
    }

    function renderTOC(fdoc){
      const headings = Array.from(fdoc.querySelectorAll('h1,h2,h3'))
        .filter(h => (h.textContent||"").trim().length > 0);

      els.toc.innerHTML = "";
      headings.forEach((h, idx)=>{
        const div = document.createElement('div');
        div.className = 'navItem';
        div.dataset.id = h.id;
        const level = h.tagName === 'H1' ? 1 : (h.tagName === 'H2' ? 2 : 3);
        div.innerHTML = `
          <div class="n">${String(idx+1).padStart(2,'0')}</div>
          <div class="navText">
            <b style="margin-left:${(level-1)*10}px">${h.textContent.trim()}</b>
            <span>${level===1?"Se√ß√£o principal":(level===2?"Subse√ß√£o":"T√≥pico")}</span>
          </div>
        `;
        div.addEventListener('click', ()=>{
          document.querySelectorAll('.navItem').forEach(x=>x.classList.remove('active'));
          div.classList.add('active');

          if(present.on){
            // In presentation, jump to slide that contains this heading
            const slide = h.closest('.ptc-slide');
            const idxSlide = present.slides.indexOf(slide);
            if(idxSlide >= 0) gotoSlide(idxSlide, fdoc, true);
          } else {
            const target = fdoc.getElementById(h.id);
            if(target) target.scrollIntoView({behavior:'smooth', block:'start'});
          }
        });
        els.toc.appendChild(div);
      });

      els.uiTocCount.textContent = `${headings.length} itens`;
    }

    function renderQuickChips(fdoc){
      const text = fdoc.body.innerText || "";
      const patterns = [
        {label:"Yard ‚ñ∏ Plan View", q:"Plan View", ic:"üó∫Ô∏è"},
        {label:"Yard ‚ñ∏ Satellite View", q:"Satellite View", ic:"üõ∞Ô∏è"},
        {label:"Yard ‚ñ∏ Block View", q:"Block View", ic:"üß±"},
        {label:"Yard ‚ñ∏ Scan View", q:"Scan View", ic:"üîç"},
        {label:"Yard ‚ñ∏ Allocation Summary", q:"Allocation Summary", ic:"üìä"},
        {label:"Yard ‚ñ∏ Stowage Warnings", q:"Stowage Warnings", ic:"‚ö†Ô∏è"},
      ];

      els.quickChips.innerHTML = "";
      patterns.forEach(p=>{
        // show chip anyway (even if not found), but gray it when absent
        const found = text.toLowerCase().includes(p.q.toLowerCase());
        const chip = document.createElement('div');
        chip.className = 'chip';
        chip.style.opacity = found ? "1" : ".55";
        chip.title = found ? "Encontrado no conte√∫do" : "N√£o encontrado no conte√∫do (pode estar em outra parte do m√≥dulo)";
        chip.innerHTML = `<span class="ic">${p.ic}</span><div><div><code>${p.label}</code></div><div style="font-size:11px;color:rgba(79,97,135,.85)">buscar: ‚Äú${p.q}‚Äù</div></div>`;
        chip.addEventListener('click', ()=>{
          els.q.value = p.q;
          // trigger search
          const ev = new Event('input');
          els.q.dispatchEvent(ev);
        });
        els.quickChips.appendChild(chip);
      });
    }

    function attachHeadingObserver(fdoc){
      const headings = Array.from(fdoc.querySelectorAll('h1,h2'))
        .filter(h => (h.textContent||"").trim().length > 0);

      const io = new IntersectionObserver((entries)=>{
        if(present.on) return;
        const visible = entries
          .filter(e=>e.isIntersecting)
          .sort((a,b)=>b.intersectionRatio - a.intersectionRatio)[0];
        if(visible){
          els.c4.textContent = visible.target.textContent.trim();
        }
      }, {root: null, threshold: [0.25, 0.5, 0.75]});

      headings.forEach(h=>io.observe(h));
    }

    function attachSearch(fdoc){
      function clearMarks(){
        fdoc.querySelectorAll('mark').forEach(m=>{
          const parent = m.parentNode;
          parent.replaceChild(fdoc.createTextNode(m.textContent), m);
          parent.normalize();
        });
      }
      function highlight(term){
        clearMarks();
        if(!term || term.length < 2) return;
        const re = new RegExp(term.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'), 'gi');

        const walker = fdoc.createTreeWalker(fdoc.body, NodeFilter.SHOW_TEXT, {
          acceptNode(node){
            if(!node.nodeValue || !node.nodeValue.trim()) return NodeFilter.FILTER_REJECT;
            const p = node.parentElement;
            if(!p) return NodeFilter.FILTER_REJECT;
            if(['SCRIPT','STYLE','NOSCRIPT'].includes(p.tagName)) return NodeFilter.FILTER_REJECT;
            return NodeFilter.FILTER_ACCEPT;
          }
        });

        const toMark = [];
        while(walker.nextNode()){
          const tn = walker.currentNode;
          if(re.test(tn.nodeValue)) toMark.push(tn);
        }

        toMark.forEach(tn=>{
          const span = fdoc.createElement('span');
          span.innerHTML = tn.nodeValue.replace(re, (x)=> `<mark>${x}</mark>`);
          tn.parentNode.replaceChild(span, tn);
        });

        const first = fdoc.querySelector('mark');
        if(first) first.scrollIntoView({behavior:'smooth', block:'center'});
      }

      // rebind once
      els.q.oninput = (e)=> highlight(e.target.value.trim());
    }

    // ----- Presentation controls -----
    function updateMeter(){
      els.meter.textContent = `${present.slides.length ? (present.idx+1) : 0} / ${present.slides.length}`;
    }

    function gotoSlide(i, fdoc, scrollHeading){
      if(!present.slides.length) return;
      present.idx = Math.max(0, Math.min(i, present.slides.length-1));
      present.slides.forEach(s=>s.classList.remove('ptc-active'));
      const active = present.slides[present.idx];
      active.classList.add('ptc-active');

      // Breadcrumb title = first heading inside the slide (H1/H2)
      const h = active.querySelector('h1,h2,h3');
      els.c4.textContent = h ? h.textContent.trim() : `Slide ${present.idx+1}`;

      updateMeter();

      if(scrollHeading){
        const top = active.querySelector('h1,h2,h3') || active;
        top.scrollIntoView({behavior:'smooth', block:'start'});
      }
    }

    function togglePresentation(on){
      const fdoc = els.frame.contentDocument;
      if(!fdoc) return;

      present.on = on;
      if(on){
        fdoc.body.classList.add('ptc-present');
        els.presentBar.classList.add('show');
        gotoSlide(present.idx, fdoc, true);
      }else{
        fdoc.body.classList.remove('ptc-present');
        els.presentBar.classList.remove('show');
      }
    }

    els.prev.addEventListener('click', ()=>{
      const fdoc = els.frame.contentDocument;
      gotoSlide(present.idx-1, fdoc, true);
    });
    els.next.addEventListener('click', ()=>{
      const fdoc = els.frame.contentDocument;
      gotoSlide(present.idx+1, fdoc, true);
    });
    els.exit.addEventListener('click', ()=> togglePresentation(false));

    window.addEventListener('keydown', (e)=>{
      if(!present.on) return;
      if(e.key === 'ArrowLeft') els.prev.click();
      if(e.key === 'ArrowRight') els.next.click();
      if(e.key === 'Escape') els.exit.click();
    });

    // Buttons
    els.btnEnhance.addEventListener('click', ()=> enhanceIframe());
    els.btnPresent.addEventListener('click', ()=> togglePresentation(!present.on));
    els.btnPrint.addEventListener('click', ()=>{
      const w = els.frame.contentWindow;
      if(w) w.print();
    });
    els.btnReset.addEventListener('click', ()=>{
      // reload iframe to original
      togglePresentation(false);
      els.frame.src = els.frame.src;
      els.toc.innerHTML = "";
      els.quickChips.innerHTML = "";
      els.uiTocCount.textContent = "0 itens";
      els.c4.textContent = "‚Äî";
      els.q.value = "";
    });

    // Auto-enhance on load
    els.frame.addEventListener('load', ()=> {
      enhanceIframe();
    });
  </script>


</body></html>